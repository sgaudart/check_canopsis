# CONFIGURATION POUR TESTER LA BONNE INSTALLATION DE CANOPSIS

# CANOPSIS
CANOPSIS,Version de Canopsis,cd $cps_home/repo/webcore/; git describe --tags,INFO
CANOPSIS,Présence du compte canopsis,grep cano /etc/passwd | wc -l,1
CANOPSIS,selinux désactivé,sestatus | grep disabled | wc -l,1


# RABBITMQ
RABBITMQ,Disponibilité du port 5672,check_port $amqp_vip $amqp_port,1
RABIITMQ,Vérification contenu etc/amqp.conf,grep $amqp_vip $cps_home/etc/amqp.conf | wc -l,1


# WEBSERVICE
WEBSERVICE,Disponibilité du port 8082,check_port localhost 8082,1
WEBSERVICE,Présence Login dans la page,curl -s http://localhost:8082/ -m 3 | grep Login | wc -l,2
WEBSERVICE,Présence brique querybuilder,su -l canopsis -c "brickmanager list | grep querybuilder | wc -l",1
WEBSERVICE,Présence brique listalarm,su -l canopsis -c "brickmanager list | grep listalarm | wc -l",1
WEBSERVICE,Présence brique timeline,su -l canopsis -c "brickmanager list | grep timeline | wc -l",1


# ENGINES
ENGINES,Disponibilité des engines,ps -ef | grep engine-launcher | wc -l,[1-9][0-9]


# MONGODB
MONGODB,Disponibilité moteur#1,check_port $mongo_host1 27017,1
MONGODB,Disponibilité moteur#2,check_port $mongo_host2 27017,1
MONGODB,Disponibilité moteur#3,check_port $mongo_host3 27017,1
MONGODB,Vérification etc/cstorage.conf,grep $mongo_hosts $cps_home/etc/cstorage.conf 2>/dev/null | wc -l,1
MONGODB,Vérification etc/common/mongo_store.conf,grep $mongo_hosts $cps_home/etc/common/mongo_store.conf 2>/dev/null | wc -l,1
MONGODB,Vérification etc/mongo/storage.conf,grep $mongo_hosts $cps_home/etc/mongo/storage.conf 2>/dev/null | wc -l,1


# SUPERVISORD
SUPERVISOR,Disponibilité du daemon,ps -ef | grep supervisord | grep -v grep | wc -l,1
SUPERVISOR,Version,$cps_home//bin/supervisord --version,INFO
SUPERVISOR,Fichiers dans etc/supervisor.d,ls $cps_home/etc/supervisord.d/*.conf | wc -l,2
SUPERVISOR,Présence cleaner dans amqp2engines.conf,grep cleaner $cps_home/etc/supervisord.d/amqp2engines.conf 2>/dev/null | wc -l,1
SUPERVISOR,Présence cancel dans amqp2engines.conf, grep cancel $cps_home/etc/supervisord.d/amqp2engines.conf 2>/dev/null | wc -l,1
SUPERVISOR,Présence acknowledgement dans amqp2engines.conf, grep acknowledgement $cps_home/etc/supervisord.d/amqp2engines.conf 2>/dev/null | wc -l,1
SUPERVISOR,Controle BACKEND dans hypcontrol.conf,grep "BACKEND=()" $cps_home/etc/hypcontrol.conf 2>/dev/null | wc -l,1
SUPERVISOR,Controle MIDDLEWARE dans hypcontrol.conf,grep "MIDDLEWARE=(amqp2engines\*)" $cps_home/etc/hypcontrol.conf 2>/dev/null | wc -l,1
SUPERVISOR,Controle FRONTEND dans hypcontrol.conf,grep "FRONTEND=(webserver)" $cps_home/etc/hypcontrol.conf 2>/dev/null | wc -l,1

# INFLUXDB
INFLUXDB,Disponibilité du moteur,check_port $influx_host $influx_port,1
INFLUXDB,Controle storage.conf,grep $influx_host $cps_home/etc/influx/storage.conf | wc -l,1
